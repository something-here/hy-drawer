<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v7.0.0-beta.7 <https://qwtel.com/hydejack/>
--><head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <!-- Begin Jekyll SEO tag v2.3.0 --> <title>src / mixin / index.js | hy-drawer</title> <meta property="og:title" content="src / mixin / index.js" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A touch-enabled drawer component for the modern web." /> <meta property="og:description" content="A touch-enabled drawer component for the modern web." /> <link rel="canonical" href="https://qwtel.com/hy-drawer/doc/source/mixin/" /> <meta property="og:url" content="https://qwtel.com/hy-drawer/doc/source/mixin/" /> <meta property="og:site_name" content="hy-drawer" /> <script type="application/ld+json"> {"name":null,"description":"A touch-enabled drawer component for the modern web.","author":null,"@type":"WebPage","url":"https://qwtel.com/hy-drawer/doc/source/mixin/","publisher":null,"image":null,"headline":"src / mixin / index.js","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> <meta name="mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-title" content="hy-drawer"> <meta name="apple-mobile-web-app-status-bar-style" content="black"> <meta name="application-name" content="hy-drawer"> <meta name="msapplication-config" content="/hy-drawer/assets/ieconfig.xml"> <meta name="theme-color" content="#4fb1ba"> <meta name="generator" content="Hydejack v7.0.0-beta.7" /> <link rel="alternate" type="application/atom+xml" title="hy-drawer Feed" href="https://qwtel.com/hy-drawer/feed.xml"> <link rel="alternate" href="https://qwtel.com/hy-drawer/doc/source/mixin/" hreflang="en"> <link rel="shortcut icon" href="/hy-drawer/assets/icons/favicon.ico"> <link rel="apple-touch-icon" href="/hy-drawer/assets/icons/icon.png"> <link rel="manifest" href="/hy-drawer/assets/manifest.json"> <link rel="dns-prefetch" href="https://fonts.googleapis.com"> <link rel="dns-prefetch" href="https://fonts.gstatic.com"> <link id="_katexJS" rel="dns-prefetch" href="/hy-drawer/assets/bower_components/katex/dist/katex.min.js"> <link id="_katexCSS" rel="dns-prefetch" href="/hy-drawer/assets/bower_components/katex/dist/katex.min.css"> <script> function stdOnEnd(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function ieOnEnd(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}window.setRelStylesheet=function(n){function e(){this.rel="stylesheet"}var o=document.getElementById(n);o.addEventListener?o.addEventListener("load",e,!1):o.onload=e},window._loaded=!1,window.loadJSDeferred=function(n,e){function o(){window._loaded=!0;var o=document.createElement("script");o.src=n,e&&(("onload"in o?stdOnEnd:ieOnEnd)(o,e),o.onload||stdOnEnd(o,e));var t=document.scripts[0];t.parentNode.insertBefore(o,t)}window._loaded?o():window.addEventListener?window.addEventListener("load",o,!1):window.onload=o}; !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); window._noPushState = false; window._noDrawer = false; </script> <!--[if gt IE 8]><!----> <script> WebFontConfig = { google: { families: ['Roboto+Slab:700','Noto+Sans:400,400i,700,700i'] }, custom: { families: ['icomoon'], urls: ['/hy-drawer/assets/icomoon/style.css'] } }; (function(d) { var wf = d.createElement('script'), s = d.scripts[0]; wf.src = "/hy-drawer/assets/bower_components/webfontloader/webfontloader.js"; s.parentNode.insertBefore(wf, s); }(document)); </script> <!--<![endif]--> <noscript> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i"> <style> html { font-family: 'Noto Sans', Helvetica, Arial, sans-serif } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Roboto Slab', Helvetica, Arial, sans-serif } </style> <link rel="stylesheet" href="/hy-drawer/assets/icomoon/style.css"> </noscript> <!--[if gt IE 8]><!----> <style> /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/pooleparty/_base.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ * { box-sizing: border-box; } html, body { margin: 0; padding: 0; } html { font-size: 16px; line-height: 1.75; } body { color: #333; background-color: #fff; overflow-y: scroll; } a { text-decoration: none; } .lead { margin-left: -1rem; margin-right: -1rem; } img, .img { display: block; max-width: 100%; margin-bottom: 1rem; border: none; } img.lead, .img.lead { max-width: calc(100% + 2rem); width: calc(100% + 2rem); } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/pooleparty/_type.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 { font-weight: bold; margin: 4rem 0 1rem; } .heading { font-weight: bold; } h1, .h1 { font-size: 2rem; line-height: 1.3; } h2, .h2 { font-size: 1.5rem; line-height: 1.4; } h3, .h3 { font-size: 1.17em; line-height: 1.5; } p { margin-top: 0; margin-bottom: 1rem; } p.lead { padding: 0 1rem; } ul, ol, dl { margin-top: 0; margin-bottom: 1rem; } ul, ol { padding-left: 1.25rem; } hr { position: relative; margin: 1.5rem 0; border: 0; border-top: 1px solid #eee; } .hr { border-bottom: 1px solid #eee; padding-bottom: .5rem; margin-bottom: 1.5rem; } .hr.page-title { padding-bottom: 1rem; margin-bottom: 2rem; } h4, h5, h6, .h4, .h5, .h6 { margin-bottom: 0.5rem; font-size: 1rem; } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/pooleparty/_table.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ table:not(.highlight) { border-collapse: collapse; margin-bottom: 2rem; margin-left: -1rem; } table:not(.highlight) td, table:not(.highlight) th { padding: .25rem .5rem; border: 1px solid #eee; } table:not(.highlight) td:first-child, table:not(.highlight) th:first-child { padding-left: 1rem; } table:not(.highlight) td:last-child, table:not(.highlight) th:last-child { padding-right: 1rem; } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/pooleparty/_footer.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/pooleparty/_footnotes.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/pooleparty/_code.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/pooleparty/_posts.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ .page { margin-bottom: 3em; } .page li + li { margin-top: .25rem; } .page > header { margin-bottom: 2rem; } .page-title, .post-title { margin-top: 0; } .post-date { display: block; margin-top: -0.5rem; margin-bottom: 1rem; color: #888; } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/pooleparty/_related.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ .related-posts { padding-left: 0; list-style: none; margin-bottom: 2rem; } .related-posts > li, .related-posts > li + li { margin-top: 1rem; } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/pooleparty/_message.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ .message { margin-bottom: 1rem; padding: 1rem; color: #666; background-color: rgba(0, 0, 0, 0.025); margin-left: -1rem; margin-right: -1rem; } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/pooleparty/_pagination.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/hydejack/_base.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ /* * Global resets * * Update the foundational and global aspects of the page. */ @media screen { body::before { content: ''; width: .5rem; background: #eee; position: absolute; left: 0; top: 0; bottom: 0; } } @media screen and (min-width: 42em) { html { font-size: 17px; } } @media screen and (min-width: 125em) { html { font-size: 18px; } } a, .a { position: relative; padding-bottom: .15rem; border-bottom: 1px solid; } .img { overflow: hidden; background-color: rgba(0, 0, 0, 0.025); } .img img { margin: 0; width: 100%; height: 100%; } .fade-in { animation-duration: 500ms; animation-name: fade-in; animation-fill-mode: forwards; } @keyframes fade-in { from { transform: translateY(-3rem); opacity: 0; } 50% { transform: translateY(-3rem); opacity: 0; } to { transform: translateY(0); opacity: 1; } } .fl { float: left; } .fr { float: right; } .mb05 { margin-bottom: 0.5rem; } .mb4 { margin-bottom: 4rem; } .mb6 { margin-bottom: 6rem; } .mt0 { margin-top: 0; } .mt3 { margin-top: 3rem; } .pb0 { padding-bottom: 0; } .clearfix, .sidebar-social::after, .clearafter::after { content: ""; display: table; clear: both; } .sr-only { display: none; } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/hydejack/_sidebar.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ .sidebar { color: rgba(255, 255, 255, 0.75); text-align: left; } .sidebar a { color: #fff; border-bottom-color: rgba(255, 255, 255, 0.2); } hy-drawer { position: relative; padding: 1rem 0; } @media screen { hy-drawer { padding: 2rem 1rem; } } @media screen and (min-width: 64em) { hy-drawer { position: fixed; top: 0; left: 0; bottom: 0; width: 18rem; margin-left: 0; } } @media screen and (min-width: 98.5em) { hy-drawer { width: calc(50% - 28rem); } } .sidebar-bg { position: absolute; top: 0; right: 0; bottom: 0; left: 0; background: #202020 center / cover; /* make sidebar slightly darker to increase text readability (when using a background image) */ } .sidebar-bg::after { content: ""; position: absolute; top: 0; left: 0; bottom: 0; right: 0; background: rgba(0, 0, 0, 0.05); } .sidebar-bg.sidebar-overlay::after { /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#202020+0,202020+100&0+0,0.5+100 */ background: linear-gradient(to bottom, rgba(32, 32, 32, 0) 0%, rgba(32, 32, 32, 0.5) 100%); } .sidebar-sticky { position: relative; z-index: 3; } @media screen { .sidebar-sticky { position: absolute; right: 1.5rem; left: 1.5rem; bottom: 1rem; } } @media screen and (min-width: 98.5em) { .sidebar-sticky { left: auto; width: 15rem; } } /* About section */ .sidebar-about > h1 { color: #fff; font-size: 2rem; } .sidebar-nav > ul { list-style: none; padding-left: 0; margin-bottom: .5rem; } a.sidebar-nav-item { font-weight: bold; display: block; line-height: 1.75; padding: .25rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.2); } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/hydejack/_social.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ .sidebar-social { margin-bottom: .5rem; } .sidebar-social > ul { list-style: none; padding-left: 0; } .sidebar-social > ul > li { float: left; } .sidebar-social > ul > li > a { display: inline-block; text-align: center; font-size: 1.5rem; width: 3rem; height: 3.5rem; padding: 0; } .sidebar-social > ul li + li { margin-top: 0; } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/hydejack/_menu.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ .fixed-top { position: fixed; top: 0; left: 0; width: 100%; z-index: 1; } .navbar > .content { padding-top: 0; padding-bottom: 0; min-height: 0; height: 0; color: #888; } .nav-btn-bar { margin-left: -.875rem; } .nav-btn { display: inline-block; padding: 1.75rem .875rem; border-bottom: none; color: #888 !important; } @media screen and (min-width: 64em) { #_menu { position: absolute; left: -9999px; } } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/hydejack/_content.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ .content { position: relative; margin-left: auto; margin-right: auto; padding: 5rem 1rem 12rem; } @media screen { .content { padding-left: 1.5rem; max-width: 38rem; min-height: 100vh; } } @media screen and (min-width: 54em) { .content { max-width: 42rem; } } @media screen and (min-width: 64em) { .content { margin-left: 22rem; margin-right: 4rem; padding-left: 1rem; } } @media screen and (min-width: 90em) { .content { max-width: 48rem; } } @media screen and (min-width: 98.5em) { .content { margin: auto; } } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/hydejack/_avatar.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ .avatar { float: right; width: 6.5rem; height: 6.5rem; margin: 0 0 .5rem 1rem; border-radius: 100%; } @media screen and (min-width: 42em) { .avatar { width: 7rem; height: 7rem; } } /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/hydejack/_katex.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ /* * THIS FILE IS AUTOGENERATED, DO NOT MODIFY! * * To change the contents of this file, * edit `_sass/hydejack/_footer.pre.scss` * and run `npm run build:css`. * * During development you can run `npm run watch:css` * to continuosly rebuild this file. */ /* .card, .pagination-item { border-radius: 0!important; } */ /* @media screen { .sidebar-sticky { left: 2rem; max-width: none; } } */ html { font-family: Helvetica, Arial, sans-serif; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: Helvetica, Arial, sans-serif; } </style> <link id="_stylePreload" rel="preload" as="style" href="/hy-drawer/assets/css/hydejack.css?v=7.0.0-beta.7"> <script>window.setRelStylesheet('_stylePreload');</script> <noscript><link rel="stylesheet" href="/hy-drawer/assets/css/hydejack.css?v=7.0.0-beta.7"></noscript> <style id="_pageStyle"> .content a:not(.btn) { color: #4fb1ba; border-color: rgba(79, 177, 186, 0.2); } .content a:not(.btn):hover { border-color: #4fb1ba; } :focus { outline-color: #4fb1ba; } .btn-primary { color: #fff; background-color: #4fb1ba; border-color: #4fb1ba; } .btn-primary:focus, .btn-primary.focus { box-shadow: 0 0 0 3px rgba(79, 177, 186, 0.5); } .btn-primary:hover, .btn-primary.hover { color: #fff; background-color: #409ba3; border-color: #409ba3; } .btn-primary:disabled, .btn-primary.disabled { color: #fff; background-color: #4fb1ba; border-color: #4fb1ba; } .btn-primary:active, .btn-primary.active { color: #fff; background-color: #409ba3; border-color: #409ba3; } ::selection { color: #fff; background: #4fb1ba; } ::-moz-selection { color: #fff; background: #4fb1ba; } </style> <!--<![endif]--> </head> <body> <div class="navbar fixed-top"> <div class="content"> <div class="nav-btn-bar"> <span class="sr-only">Jump to:</span> <a id="_menu" class="nav-btn no-hover" href="#_navigation"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a> </div> </div> </div> <hy-push-state> <main id="_main" class="content fade-in layout-page" role="main" data-color="#4fb1ba" data-background="linear-gradient(to bottom,#193747 0%,#233e4c 30%,#3c929e 50%,#d5d5d4 70%,#cdccc8 100%)" data-overlay > <article class="page" role="article"> <header> <h1 class="page-title">src / mixin / index.js</h1> <div class="hr pb0"></div> </header> <p>Copyright (c) 2017 Florian Klampfer <a href="https://qwtel.com/">https://qwtel.com/</a></p> <p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p> <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p> <p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p> <h2 id="overview">Overview</h2> <p>This component is written in <a href="https://github.com/ReactiveX/rxjs">RxJS</a> and reading its code requires some basic understanding of how RxJS works. It may also serve as an example of how to use RxJS (or how not to use it…).</p> <p>Other than RxJS, you should be familiar with the (non-standard) function-bind syntax <code class="highlighter-rouge">::</code>, which is extremely helpful with using RxJS operators <em>as if</em> they were class methods, as well as writing private functions for our mixin.</p> <p>Finally, the export is a <a href="http://justinfagnani.com/2015/12/21/real-mixins-with-javascript-classes/">ES6 Mixin</a>, which is a clever way of using the ES6 class syntax to achieve inheritance-based mixins.</p> <h2 class="no_toc" id="table-of-contents">Table of Contents</h2> <ul id="markdown-toc"> <li><a href="#overview" id="markdown-toc-overview">Overview</a></li> <li><a href="#imports" id="markdown-toc-imports">Imports</a></li> <li><a href="#constants" id="markdown-toc-constants">Constants</a></li> <li><a href="#fuctions" id="markdown-toc-fuctions">Fuctions</a> <ul> <li><a href="#observable-extensions" id="markdown-toc-observable-extensions">Observable extensions</a> <ul> <li><a href="#filter-when" id="markdown-toc-filter-when">Filter when</a></li> <li><a href="#subscribe-when" id="markdown-toc-subscribe-when">Subscribe when</a></li> </ul> </li> <li><a href="#private-methods" id="markdown-toc-private-methods">Private Methods</a> <ul> <li><a href="#is-in-range" id="markdown-toc-is-in-range">Is in range?</a></li> <li><a href="#calculate-will-open" id="markdown-toc-calculate-will-open">Calculate ‘Will open?’</a></li> <li><a href="#calculate-translate-x" id="markdown-toc-calculate-translate-x">Calculate translate X</a></li> <li><a href="#get-movable-drawer-width" id="markdown-toc-get-movable-drawer-width">Get movable drawer width</a></li> <li><a href="#prepare-and-cleanup-interaction" id="markdown-toc-prepare-and-cleanup-interaction">Prepare and cleanup interaction</a></li> <li><a href="#update-dom" id="markdown-toc-update-dom">Update DOM</a></li> <li><a href="#get-start-observable" id="markdown-toc-get-start-observable">Get start observable</a></li> <li><a href="#get-move-observable" id="markdown-toc-get-move-observable">Get move observable</a></li> <li><a href="#get-end-observable" id="markdown-toc-get-end-observable">Get end observable</a></li> <li><a href="#get-is-sliding-observable" id="markdown-toc-get-is-sliding-observable">Get “Is sliding?” observable</a></li> </ul> </li> <li><a href="#setup-observables" id="markdown-toc-setup-observables">Setup observables</a> <ul> <li><a href="#start-observable" id="markdown-toc-start-observable">Start observable</a></li> <li><a href="#end-observable" id="markdown-toc-end-observable">End observable</a></li> <li><a href="#move-observable" id="markdown-toc-move-observable">Move observable</a></li> <li><a href="#is-sliding-observable" id="markdown-toc-is-sliding-observable">‘Is sliding?’ observable</a></li> <li><a href="#translate-x-observable" id="markdown-toc-translate-x-observable">Translate X observable</a></li> <li><a href="#tween-observable" id="markdown-toc-tween-observable">Tween observable</a></li> <li><a href="#subscriptions" id="markdown-toc-subscriptions">Subscriptions</a></li> </ul> </li> </ul> </li> <li><a href="#drawer-mixin" id="markdown-toc-drawer-mixin">Drawer Mixin</a> <ul> <li><a href="#setup" id="markdown-toc-setup">Setup</a></li> <li><a href="#options" id="markdown-toc-options">Options</a></li> <li><a href="#methods" id="markdown-toc-methods">Methods</a></li> </ul> </li> </ul> <h2 id="imports">Imports</h2> <p>ES6+ functions that we use.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="s1">'core-js/fn/array/from'</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">'core-js/fn/function/bind'</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">'core-js/fn/object/assign'</span><span class="p">;</span>
</code></pre></div></div> <p>Importing the hy-compontent base libary, which helps with making multiple versions of the component (Vanilla JS, WebComponent, etc…).</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">componentMixin</span><span class="p">,</span> <span class="nx">COMPONENT_FEATURE_TESTS</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'hy-component/src/component'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">sSetup</span><span class="p">,</span> <span class="nx">sSetupDOM</span><span class="p">,</span> <span class="nx">sFire</span><span class="p">,</span> <span class="nx">sSetState</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'hy-component/src/symbols'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">arrayOf</span><span class="p">,</span> <span class="nx">bool</span><span class="p">,</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">oneOf</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'hy-component/src/types'</span><span class="p">;</span>
</code></pre></div></div> <p>As mentioned before, we only import the RxJS function that we need.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/Observable'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Subject</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/Subject'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">combineLatest</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/observable/combineLatest'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">defer</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/observable/defer'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">fromEvent</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/observable/fromEvent'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">merge</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/observable/merge'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">never</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/observable/never'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">_do</span> <span class="k">as</span> <span class="nx">effect</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/do'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">debounceTime</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/debounceTime'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">filter</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/filter'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">map</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/map'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">mapTo</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/mapTo'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">pairwise</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/pairwise'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">repeatWhen</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/repeatWhen'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">sample</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/sample'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">share</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/share'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">skipWhile</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/skipWhile'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">startWith</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/startWith'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">switchMap</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/switchMap'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">take</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/take'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">takeUntil</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/takeUntil'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">timestamp</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/timestamp'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">withLatestFrom</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'rxjs/operator/withLatestFrom'</span><span class="p">;</span>
</code></pre></div></div> <p>Some helper functions to create observable tweens. See <a href="/hy-drawer/doc/source/common/">src / common.js</a>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createTween</span><span class="p">,</span> <span class="nx">linearTween</span><span class="p">,</span> <span class="nb">Set</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'../common'</span><span class="p">;</span>
</code></pre></div></div> <h2 id="constants">Constants</h2> <p>A set of <a href="https://modernizr.com/">Modernizr</a> tests that are required for this component to work.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">MIXIN_FEATURE_TESTS</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Set</span><span class="p">([</span>
  <span class="p">...</span><span class="nx">COMPONENT_FEATURE_TESTS</span><span class="p">,</span>
  <span class="s1">'eventlistener'</span><span class="p">,</span>
  <span class="s1">'queryselector'</span><span class="p">,</span>
  <span class="s1">'requestanimationframe'</span><span class="p">,</span>
  <span class="s1">'classlist'</span><span class="p">,</span>
  <span class="s1">'opacity'</span><span class="p">,</span>
  <span class="s1">'csstransforms'</span><span class="p">,</span>
  <span class="s1">'csspointerevents'</span><span class="p">,</span>
<span class="p">]);</span>
</code></pre></div></div> <p>We export the setup symbols, so that mixin users don’t have to import them from hy-compnent separately.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="p">{</span> <span class="nx">sSetup</span><span class="p">,</span> <span class="nx">sSetupDOM</span> <span class="p">};</span>
</code></pre></div></div> <p>The duration (in ms) of the animation when releasing the drawer.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">TRANSITION_DURATION</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
</code></pre></div></div> <p>Minimum velocity of the drawer (in px/ms) when releasing to make it fling to opened/closed state.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">VELOCITY_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">;</span>
</code></pre></div></div> <p>If <code class="highlighter-rouge">Symbol</code> isn’t supported, just use underscore naming convention for private properties.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nb">Symbol</span> <span class="o">=</span> <span class="nb">global</span><span class="p">.</span><span class="nb">Symbol</span> <span class="o">||</span> <span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`_</span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
</code></pre></div></div> <p>We use <code class="highlighter-rouge">Symbol</code>s for all internal variables, to avoid naming conflicts when using the mixin. Instead of using UPPERCASE names for symbols, which makes the code too verbose, we prefix every symbol with the letter ‘s’.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">sOpened$</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'openedObservable'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sAlign$</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'alignObservable'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sPersitent$</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'persistentObservable'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sPreventDefault$</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'preventDefaultObservable'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sMouseEvents$</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'mouseEventsObservable'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sBackButton$</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'backButtonObservable'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sAnimateTo$</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'animateToObservable'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sDrawerWidth</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'drawerWidth'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sScrimEl</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'scrimElement'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sContentEl</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'contentElement'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sScrollEl</span> <span class="o">=</span> <span class="nb">Symbol</span><span class="p">(</span><span class="s1">'scrollElement'</span><span class="p">);</span>
</code></pre></div></div> <p>Using shorthands for common functions</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">assign</span> <span class="o">=</span> <span class="p">::</span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">abs</span> <span class="o">=</span> <span class="p">::</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">min</span> <span class="o">=</span> <span class="p">::</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">max</span> <span class="o">=</span> <span class="p">::</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">;</span>
</code></pre></div></div> <h2 id="fuctions">Fuctions</h2> <h3 id="observable-extensions">Observable extensions</h3> <h4 id="filter-when">Filter when</h4> <p>This operator is like <code class="highlighter-rouge">filter</code>, but it takes an observable of booleans as input, instead of a predicate function.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">filterWhen</span><span class="p">(</span><span class="nx">p$</span><span class="p">,</span> <span class="p">...</span><span class="nx">others</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DEBUG</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">p$</span><span class="p">)</span> <span class="k">throw</span> <span class="nb">Error</span><span class="p">();</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">others</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">::</span><span class="nx">withLatestFrom</span><span class="p">(</span><span class="nx">p$</span><span class="p">)::</span><span class="nx">filter</span><span class="p">(([,</span> <span class="nx">p</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">)::</span><span class="nx">map</span><span class="p">(([</span><span class="nx">x</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="nx">x</span><span class="p">);</span>
</code></pre></div></div> <p>When providing more than one observable, the result observable will only emit values when <code class="highlighter-rouge">every</code> input observable has emitted a truthy value.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="na">this</span><span class="p">::</span><span class="nx">withLatestFrom</span><span class="p">(</span><span class="nx">p$</span><span class="p">,</span> <span class="p">...</span><span class="nx">others</span><span class="p">)</span>
      <span class="p">::</span><span class="nx">filter</span><span class="p">(([,</span> <span class="p">...</span><span class="nx">ps</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="nx">ps</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">))</span>
      <span class="p">::</span><span class="nx">map</span><span class="p">(([</span><span class="nx">x</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="nx">x</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="subscribe-when">Subscribe when</h4> <p>This operator is like <code class="highlighter-rouge">filterWhen</code>, but it will unsubscribe from the source observable when the input observable emits <code class="highlighter-rouge">false</code>, and re-subscribe when it emits <code class="highlighter-rouge">true</code>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">subscribeWhen</span><span class="p">(</span><span class="nx">p$</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DEBUG</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">p$</span><span class="p">)</span> <span class="k">throw</span> <span class="nb">Error</span><span class="p">();</span>
  <span class="k">return</span> <span class="nx">p$</span><span class="p">::</span><span class="nx">switchMap</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">p</span> <span class="p">?</span> <span class="k">this</span> <span class="p">:</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">never</span><span class="p">()));</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="private-methods">Private Methods</h3> <p>The functions are used as “private” methods on the mixin, using the <code class="highlighter-rouge">::</code> syntax.</p> <h4 id="is-in-range">Is in range?</h4> <p>Given a x-coordinate, <code class="highlighter-rouge">isInRange</code> will determine whether it is within range from where to pull the drawer. The x-coordinate <em>must</em> be larger than the lower bound, but when the drawer is opened it may be anywhere on the screen. Otherwise it must be below the upper bound.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">isInRange</span><span class="p">(</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">opened</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">align</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'left'</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">clientX</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">opened</span> <span class="o">||</span> <span class="nx">clientX</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">case</span> <span class="s1">'right'</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">clientX</span> <span class="o">&lt;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">opened</span> <span class="o">||</span> <span class="nx">clientX</span> <span class="o">&gt;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">throw</span> <span class="nb">Error</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="calculate-will-open">Calculate ‘Will open?’</h4> <p>Based on current velocity and position of the drawer, should the drawer slide open, or snap back? TODO: could incorporate the current open state of the drawer.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">calcWillOpen</span><span class="p">(</span><span class="nx">velocity</span><span class="p">,</span> <span class="nx">translateX</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">align</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'left'</span><span class="p">:</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">velocity</span> <span class="o">&gt;</span> <span class="nx">VELOCITY_THRESHOLD</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">velocity</span> <span class="o">&lt;</span> <span class="o">-</span><span class="nx">VELOCITY_THRESHOLD</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">translateX</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">[</span><span class="nx">sDrawerWidth</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">case</span> <span class="s1">'right'</span><span class="p">:</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="nx">velocity</span> <span class="o">&gt;</span> <span class="nx">VELOCITY_THRESHOLD</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="nx">velocity</span> <span class="o">&lt;</span> <span class="o">-</span><span class="nx">VELOCITY_THRESHOLD</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">translateX</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="k">this</span><span class="p">[</span><span class="nx">sDrawerWidth</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">throw</span> <span class="nb">Error</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="calculate-translate-x">Calculate translate X</h4> <p>Calcuate the current position of the drawer, by taking the difference between the current and starting postion of the finger, then adding that difference to the starting position of the drawer. This way, we avoid the drawer jumping to the finger, when “catching” it during an animation. The function will also clip the position at 0 and the width of the drawer.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">calcTranslateX</span><span class="p">(</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">startX</span><span class="p">,</span> <span class="nx">startTranslateX</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">align</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'left'</span><span class="p">:</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">deltaX</span> <span class="o">=</span> <span class="nx">clientX</span> <span class="o">-</span> <span class="nx">startX</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">translateX</span> <span class="o">=</span> <span class="nx">startTranslateX</span> <span class="o">+</span> <span class="nx">deltaX</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">min</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">sDrawerWidth</span><span class="p">],</span> <span class="nx">translateX</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">case</span> <span class="s1">'right'</span><span class="p">:</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">deltaX</span> <span class="o">=</span> <span class="nx">clientX</span> <span class="o">-</span> <span class="nx">startX</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">translateX</span> <span class="o">=</span> <span class="nx">startTranslateX</span> <span class="o">+</span> <span class="nx">deltaX</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">min</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">max</span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">[</span><span class="nx">sDrawerWidth</span><span class="p">],</span> <span class="nx">translateX</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">throw</span> <span class="nb">Error</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="get-movable-drawer-width">Get movable drawer width</h4> <p>One feature of hy-drawer is to allow the drawer to “peek” over the edge. This effect is achieved by setting a smaller negative <code class="highlighter-rouge">left</code> (<code class="highlighter-rouge">right</code>) CSS property, than is the width of the drawer, The ‘moveable’ part of the drawer, then, is equal to that the inverse of that property. See <a href="/hy-drawer/doc/styling/">Styling</a> for more.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getMovableDrawerWidth</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">-</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">])[</span><span class="k">this</span><span class="p">.</span><span class="nx">align</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="prepare-and-cleanup-interaction">Prepare and cleanup interaction</h4> <p><code class="highlighter-rouge">prepareInteraction</code> causes various side effects before sliding the drawer.</p> <p>Note that the drawer receives the <code class="highlighter-rouge">hy-drawer-opened</code> CSS class when it is opened. This class makes the drawer appear open by setting the CSS <code class="highlighter-rouge">left</code> (<code class="highlighter-rouge">right</code>) property, instead of an absoulte <code class="highlighter-rouge">transform</code> value. This way, the drawer’s width can change while it is open without having to recalculate <code class="highlighter-rouge">translateX</code> on every <code class="highlighter-rouge">resize</code>. However, it has to be removed before we move the drawer via <code class="highlighter-rouge">translateX</code> again.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">prepareInteraction</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">willChange</span> <span class="o">=</span> <span class="s1">'transform'</span><span class="p">;</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sScrimEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">willChange</span> <span class="o">=</span> <span class="s1">'opacity'</span><span class="p">;</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'hy-drawer-opened'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">histId</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="kd">constructor</span><span class="p">.</span><span class="nx">componentName</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Cleanup code after a completed interaction. Will add/remove the beforementioned <code class="highlighter-rouge">hy-drawer-opened</code> class.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">cleanupInteraction</span><span class="p">(</span><span class="nx">opened</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sScrimEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">willChange</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">willChange</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">opened</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">sScrimEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">pointerEvents</span> <span class="o">=</span> <span class="s1">'all'</span><span class="p">;</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'hy-drawer-opened'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">sScrimEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">pointerEvents</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'hy-drawer-opened'</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div> <p>If the experimental back button feature is enabled we hack the history API, so that it matches the state of the drawer…</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_backButton</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">::</span><span class="nx">histId</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="s2">`#</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">--opened`</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">opened</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">!==</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">({</span> <span class="p">[</span><span class="nx">id</span><span class="p">]:</span> <span class="kc">true</span> <span class="p">},</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">hash</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opened</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">state</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">state</span><span class="p">[</span><span class="k">this</span><span class="p">::</span><span class="nx">histId</span><span class="p">()])</span>
        <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">!==</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div> <p>Once we’re finished cleaning up, we fire the <code class="highlighter-rouge">transitioned</code> event.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">this</span><span class="p">[</span><span class="nx">sFire</span><span class="p">](</span><span class="s1">'transitioned'</span><span class="p">,</span> <span class="p">{</span> <span class="na">detail</span><span class="p">:</span> <span class="nx">opened</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="update-dom">Update DOM</h4> <p>In the end, we only modify two properties: The x-coordinate of the drawer, and the opacity of the scrim, which is handled by <code class="highlighter-rouge">updateDOM</code>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">updateDOM</span><span class="p">(</span><span class="nx">translateX</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">inv</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">align</span> <span class="o">===</span> <span class="s1">'left'</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="s2">`translateX(</span><span class="p">${</span><span class="nx">translateX</span><span class="p">}</span><span class="s2">px)`</span><span class="p">;</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sScrimEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="p">(</span><span class="nx">translateX</span> <span class="o">/</span> <span class="k">this</span><span class="p">[</span><span class="nx">sDrawerWidth</span><span class="p">])</span> <span class="o">*</span> <span class="nx">inv</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="get-start-observable">Get start observable</h4> <p>The following function returns an observable of all “start” events. Usually, that’s just <code class="highlighter-rouge">touchstart</code> event of the first finger touching the screen, however since the compontent also supports mouse events, we may listen for <code class="highlighter-rouge">mousedown</code> events.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getStartObservable</span><span class="p">()</span> <span class="p">{</span>
</code></pre></div></div> <p>Since the <code class="highlighter-rouge">mouseEvents</code> option may change at any point, we <code class="highlighter-rouge">switchMap</code> to reflect the changes.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">sMouseEvents$</span><span class="p">]::</span><span class="nx">switchMap</span><span class="p">((</span><span class="nx">mouseEvents</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</code></pre></div></div> <p>The touchstart observable is passive since we won’t be calling <code class="highlighter-rouge">preventDefault</code>. Also, we’re only interested in the first <code class="highlighter-rouge">touchstart</code>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">touchstart$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">'touchstart'</span><span class="p">,</span> <span class="p">{</span> <span class="na">passive</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
      <span class="p">::</span><span class="nx">filter</span><span class="p">(({</span> <span class="nx">touches</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">::</span><span class="nx">map</span><span class="p">(({</span> <span class="nx">touches</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</code></pre></div></div> <p>If mouse events aren’t enabled, we’re done here.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mouseEvents</span><span class="p">)</span> <span class="k">return</span> <span class="nx">touchstart$</span><span class="p">;</span>
</code></pre></div></div> <p>Otherwise we also include <code class="highlighter-rouge">mousedown</code> events in the output.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">mousedown$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">'mousedown'</span><span class="p">,</span> <span class="p">{</span> <span class="na">passive</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    <span class="k">return</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">merge</span><span class="p">(</span><span class="nx">touchstart$</span><span class="p">,</span> <span class="nx">mousedown$</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="get-move-observable">Get move observable</h4> <p>This function returns an observable of all move events. Usually that’s just <code class="highlighter-rouge">touchmove</code>, but may also include <code class="highlighter-rouge">mousemove</code> events while the mouse button is down.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getMoveObservable</span><span class="p">(</span><span class="nx">start$</span><span class="p">,</span> <span class="nx">end$</span><span class="p">)</span> <span class="p">{</span>
</code></pre></div></div> <p>Since the <code class="highlighter-rouge">mouseEvents</code> or <code class="highlighter-rouge">preventDefault</code> option may change at any point, we <code class="highlighter-rouge">switchMap</code> to reflect the changes. Nice: <code class="highlighter-rouge">combineLatest</code> provides us with the functionality of emitting when either of the inputs change, but not before all inputs have their first value set.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">return</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">combineLatest</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">sMouseEvents$</span><span class="p">],</span> <span class="k">this</span><span class="p">[</span><span class="nx">sPreventDefault$</span><span class="p">])</span>
    <span class="p">::</span><span class="nx">switchMap</span><span class="p">(([</span><span class="nx">mouseEvents</span><span class="p">,</span> <span class="nx">preventDefault</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="p">{</span>
</code></pre></div></div> <p>We’re only keeping track of the first finger. Should the user remove the finger that started the interaction, we use the next instead. Note that this doesn’t occur under normal circumstances, and exists primarliy to ensure that the interaction continues without hiccups. Note that the event listener is only passive when the <code class="highlighter-rouge">preventDefault</code> option is falsy.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="kd">const</span> <span class="nx">touchmove$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">'touchmove'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">passive</span><span class="p">:</span> <span class="o">!</span><span class="nx">preventDefault</span><span class="p">,</span>
      <span class="p">})</span>
        <span class="p">::</span><span class="nx">map</span><span class="p">(</span><span class="nx">event</span> <span class="o">=&gt;</span> <span class="nx">assign</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">{</span> <span class="nx">event</span> <span class="p">}));</span>
</code></pre></div></div> <p>If mouse events aren’t enabled, we’re done here.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mouseEvents</span><span class="p">)</span> <span class="k">return</span> <span class="nx">touchmove$</span><span class="p">;</span>
</code></pre></div></div> <p>Otherwise we listen for <code class="highlighter-rouge">mousemove</code> events, but only those between a <code class="highlighter-rouge">start</code> and <code class="highlighter-rouge">end</code> event, i.e. while the user is sliding. We unsubscribe form the source observable outside of those contraints. Again, the listener is only marked as passive when the <code class="highlighter-rouge">preventDefault</code> option is falsy.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="kd">const</span> <span class="nx">mousemove$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">'mousemove'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">passive</span><span class="p">:</span> <span class="o">!</span><span class="nx">preventDefault</span><span class="p">,</span>
      <span class="p">})</span>
        <span class="p">::</span><span class="nx">subscribeWhen</span><span class="p">(</span><span class="nx">Observable</span><span class="p">::</span><span class="nx">merge</span><span class="p">(</span><span class="nx">start$</span><span class="p">::</span><span class="nx">mapTo</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span> <span class="nx">end$</span><span class="p">::</span><span class="nx">mapTo</span><span class="p">(</span><span class="kc">false</span><span class="p">)))</span>
        <span class="p">::</span><span class="nx">map</span><span class="p">(</span><span class="nx">event</span> <span class="o">=&gt;</span> <span class="nx">assign</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="p">{</span> <span class="nx">event</span> <span class="p">}));</span>

      <span class="k">return</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">merge</span><span class="p">(</span><span class="nx">touchmove$</span><span class="p">,</span> <span class="nx">mousemove$</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="get-end-observable">Get end observable</h4> <p>This function returns an observable of end events. Usually, this is the <code class="highlighter-rouge">touchend</code> event of the last finger, but may also include <code class="highlighter-rouge">mouseup</code> events, when the <code class="highlighter-rouge">mouseEvents</code> option is enabled.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getEndObservable</span><span class="p">()</span> <span class="p">{</span>
</code></pre></div></div> <p>Since the <code class="highlighter-rouge">mouseEvents</code> option may change at any point, we <code class="highlighter-rouge">switchMap</code> to reflect the changes.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">sMouseEvents$</span><span class="p">]::</span><span class="nx">switchMap</span><span class="p">((</span><span class="nx">mouseEvents</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</code></pre></div></div> <p>We’re only interested in the last <code class="highlighter-rouge">touchend</code>. Otherwise there’s at least one finger left on the screen, that can be used to slide the drawer.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">touchend$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">'touchend'</span><span class="p">,</span> <span class="p">{</span> <span class="na">passive</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
      <span class="p">::</span><span class="nx">filter</span><span class="p">(({</span> <span class="nx">touches</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span>
</code></pre></div></div> <p>If mouse events aren’t enabled, we’re done here.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mouseEvents</span><span class="p">)</span> <span class="k">return</span> <span class="nx">touchend$</span><span class="p">;</span>
</code></pre></div></div> <p>Otherwise we include <code class="highlighter-rouge">mouseup</code> events.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">mouseup$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">'mouseup'</span><span class="p">,</span> <span class="p">{</span> <span class="na">passive</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    <span class="k">return</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">merge</span><span class="p">(</span><span class="nx">touchend$</span><span class="p">,</span> <span class="nx">mouseup$</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="get-is-sliding-observable">Get “Is sliding?” observable</h4> <p>An observable that emits <code class="highlighter-rouge">true</code> when the user is <em>sliding</em> the drawer, (i.e. moving the finger along the x-axis), or <code class="highlighter-rouge">false</code> when <em>scrolling</em> the page (i.e. moving the finger along the y-axis).</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getIsSlidingObservable</span><span class="p">(</span><span class="nx">move$</span><span class="p">,</span> <span class="nx">start$</span><span class="p">)</span> <span class="p">{</span>
</code></pre></div></div> <p>If the threshold options is set, we delay the decision until the finger has moved at least <code class="highlighter-rouge">threshold</code> pixels in either direction.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">threshold</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">move$</span><span class="p">::</span><span class="nx">withLatestFrom</span><span class="p">(</span><span class="nx">start$</span><span class="p">)</span>
      <span class="p">::</span><span class="nx">skipWhile</span><span class="p">(([{</span> <span class="nx">clientX</span><span class="p">,</span> <span class="nx">clientY</span> <span class="p">},</span> <span class="p">{</span> <span class="na">clientX</span><span class="p">:</span> <span class="nx">startX</span><span class="p">,</span> <span class="na">clientY</span><span class="p">:</span> <span class="nx">startY</span> <span class="p">}])</span> <span class="o">=&gt;</span>
        <span class="nx">abs</span><span class="p">(</span><span class="nx">startY</span> <span class="o">-</span> <span class="nx">clientY</span><span class="p">)</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">threshold</span> <span class="o">&amp;&amp;</span> <span class="nx">abs</span><span class="p">(</span><span class="nx">startX</span> <span class="o">-</span> <span class="nx">clientX</span><span class="p">)</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">threshold</span><span class="p">)</span>
      <span class="p">::</span><span class="nx">map</span><span class="p">(([{</span> <span class="nx">clientX</span><span class="p">,</span> <span class="nx">clientY</span> <span class="p">},</span> <span class="p">{</span> <span class="na">clientX</span><span class="p">:</span> <span class="nx">startX</span><span class="p">,</span> <span class="na">clientY</span><span class="p">:</span> <span class="nx">startY</span> <span class="p">}])</span> <span class="o">=&gt;</span>
        <span class="nx">abs</span><span class="p">(</span><span class="nx">startX</span> <span class="o">-</span> <span class="nx">clientX</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">abs</span><span class="p">(</span><span class="nx">startY</span> <span class="o">-</span> <span class="nx">clientY</span><span class="p">));</span>
</code></pre></div></div> <p>If the threshold option is set to <code class="highlighter-rouge">0</code> (or <code class="highlighter-rouge">false</code>) we make a decision immediately. This is intended for Safari and possibly other browsers that have a built-in threshold. Additionally, Safari ignores all calls to <code class="highlighter-rouge">preventDefault</code>, except on the first move event after a start event, so that we <em>have to</em> make a decision immediately.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">move</span><span class="na">$</span><span class="p">::</span><span class="nx">withLatestFrom</span><span class="p">(</span><span class="nx">start$</span><span class="p">)</span>
      <span class="p">::</span><span class="nx">map</span><span class="p">(([{</span> <span class="nx">clientX</span><span class="p">,</span> <span class="nx">clientY</span><span class="p">,</span> <span class="nx">event</span> <span class="p">},</span> <span class="p">{</span> <span class="na">clientX</span><span class="p">:</span> <span class="nx">startX</span><span class="p">,</span> <span class="na">clientY</span><span class="p">:</span> <span class="nx">startY</span> <span class="p">}])</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">isSliding</span> <span class="o">=</span> <span class="nx">abs</span><span class="p">(</span><span class="nx">startX</span> <span class="o">-</span> <span class="nx">clientX</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">abs</span><span class="p">(</span><span class="nx">startY</span> <span class="o">-</span> <span class="nx">clientY</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preventDefault</span> <span class="o">&amp;&amp;</span> <span class="nx">isSliding</span><span class="p">)</span> <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">isSliding</span><span class="p">;</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="setup-observables">Setup observables</h3> <p>This function sets up the observable “pipeline”.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">setupObservables</span><span class="p">()</span> <span class="p">{</span>
</code></pre></div></div> <p>Observables used for side effects caused by changing settings on the component. The are used to emit the new vale whenever properties get changed on the component.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">this</span><span class="p">[</span><span class="nx">sOpened$</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sAlign$</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sPersitent$</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sPreventDefault$</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sMouseEvents$</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sBackButton$</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sAnimateTo$</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</code></pre></div></div> <p>Emitts a value every time you change the <code class="highlighter-rouge">persistent</code> property of the drawer. Interally, we invert it and call it <code class="highlighter-rouge">active</code>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">const</span> <span class="nx">active$</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">sPersitent$</span><span class="p">]::</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">x</span><span class="p">)::</span><span class="nx">share</span><span class="p">();</span>
</code></pre></div></div> <p>We use this to get references to observables that aren’t defined yet.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="p">{};</span>
</code></pre></div></div> <h4 id="start-observable">Start observable</h4> <p>Emits a value every time a start event <em>could</em> intiate an interaction. Each emitted value is a hash containing a <code class="highlighter-rouge">clientX</code> and <code class="highlighter-rouge">clientY</code> key.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">const</span> <span class="nx">start$</span> <span class="o">=</span> <span class="k">this</span><span class="p">::</span><span class="nx">getStartObservable</span><span class="p">()</span>
    <span class="p">::</span><span class="nx">filterWhen</span><span class="p">(</span><span class="nx">active$</span><span class="p">)</span>
    <span class="p">::</span><span class="nx">share</span><span class="p">();</span>
</code></pre></div></div> <p>An observable that emits <code class="highlighter-rouge">true</code>, as long as the drawer isn’t fully closed (as long as the scrim is visible the user can still “catch” the drawer). It references the yet-to-be-defined <code class="highlighter-rouge">translateX</code> obsevable, so we wrap it inside a <code class="highlighter-rouge">defer</code>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">const</span> <span class="nx">isScrimVisible$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">defer</span><span class="p">(()</span> <span class="o">=&gt;</span>
      <span class="nx">ref</span><span class="p">.</span><span class="nx">translateX$</span><span class="p">::</span><span class="nx">map</span><span class="p">(</span><span class="nx">translateX</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">align</span> <span class="o">===</span> <span class="s1">'left'</span> <span class="p">?</span>
        <span class="nx">translateX</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
        <span class="nx">translateX</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">[</span><span class="nx">sDrawerWidth</span><span class="p">])));</span>
</code></pre></div></div> <p>TODO: …</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">const</span> <span class="nx">isInRange$</span> <span class="o">=</span> <span class="nx">start$</span>
    <span class="p">::</span><span class="nx">withLatestFrom</span><span class="p">(</span><span class="nx">isScrimVisible$</span><span class="p">)</span>
    <span class="p">::</span><span class="nx">map</span><span class="p">(([{</span> <span class="nx">clientX</span> <span class="p">},</span> <span class="nx">isScrimVisible</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">::</span><span class="nx">isInRange</span><span class="p">(</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">isScrimVisible</span><span class="p">))</span>
    <span class="p">::</span><span class="nx">effect</span><span class="p">((</span><span class="nx">inRange</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">inRange</span><span class="p">)</span> <span class="na">this</span><span class="p">::</span><span class="nx">prepareInteraction</span><span class="p">();</span> <span class="p">})</span>
    <span class="p">::</span><span class="nx">share</span><span class="p">();</span>
</code></pre></div></div> <h4 id="end-observable">End observable</h4> <p>The observable of all relevant “end” events, i.e. the last <code class="highlighter-rouge">touchend</code> (or <code class="highlighter-rouge">mouseup</code>),</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">const</span> <span class="nx">end$</span> <span class="o">=</span> <span class="k">this</span><span class="p">::</span><span class="nx">getEndObservable</span><span class="p">()</span>
    <span class="p">::</span><span class="nx">filterWhen</span><span class="p">(</span><span class="nx">active$</span><span class="p">,</span> <span class="nx">isInRange$</span><span class="p">)</span>
    <span class="p">::</span><span class="nx">share</span><span class="p">();</span>
</code></pre></div></div> <h4 id="move-observable">Move observable</h4> <p>The observable of all relevant “move” events.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">const</span> <span class="nx">move$</span> <span class="o">=</span> <span class="k">this</span><span class="p">::</span><span class="nx">getMoveObservable</span><span class="p">(</span><span class="nx">start$</span><span class="p">,</span> <span class="nx">end$</span><span class="p">)</span>
    <span class="p">::</span><span class="nx">filterWhen</span><span class="p">(</span><span class="nx">active$</span><span class="p">,</span> <span class="nx">isInRange$</span><span class="p">)</span>
    <span class="p">::</span><span class="nx">share</span><span class="p">();</span>
</code></pre></div></div> <h4 id="is-sliding-observable">‘Is sliding?’ observable</h4> <p>The value is <code class="highlighter-rouge">undefind</code> until we are ready to make a decision An observable that emits <code class="highlighter-rouge">true</code> when the user is <em>sliding</em> the drawer, (i.e. moving the finger along the x-axis), or <code class="highlighter-rouge">false</code> when <em>scrolling</em> the page (i.e. moving the finger along the y-axis), and <code class="highlighter-rouge">undefined</code> while we aren’t sure yet.</p> <p>(see <a href="#get-is-sliding-observable"><code class="highlighter-rouge">getIsSlidingObservable</code></a>), then it remains <code class="highlighter-rouge">true</code>/<code class="highlighter-rouge">false</code> for the remainder of the interaction, and is <code class="highlighter-rouge">undefined</code> again once the interaction <code class="highlighter-rouge">end</code>s.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">const</span> <span class="nx">isSliding$</span> <span class="o">=</span> <span class="k">this</span><span class="p">::</span><span class="nx">getIsSlidingObservable</span><span class="p">(</span><span class="nx">move$</span><span class="p">,</span> <span class="nx">start$</span><span class="p">)</span>
    <span class="p">::</span><span class="nx">take</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">::</span><span class="nx">startWith</span><span class="p">(</span><span class="kc">undefined</span><span class="p">)</span>
    <span class="p">::</span><span class="nx">repeatWhen</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">end$</span><span class="p">)</span>
</code></pre></div></div> <p>When the user is sliding, fire the <code class="highlighter-rouge">slidestart</code> event. Experimental: Set <code class="highlighter-rouge">overflow: hidden</code> on some container element.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">::</span><span class="nx">effect</span><span class="p">((</span><span class="nx">isSliding</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isSliding</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">sScrollEl</span><span class="p">])</span> <span class="k">this</span><span class="p">[</span><span class="nx">sScrollEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">overflow</span> <span class="o">=</span> <span class="s1">'hidden'</span><span class="p">;</span>
        <span class="k">this</span><span class="p">[</span><span class="nx">sFire</span><span class="p">](</span><span class="s1">'slidestart'</span><span class="p">,</span> <span class="p">{</span> <span class="na">detail</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">opened</span> <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
</code></pre></div></div> <h4 id="translate-x-observable">Translate X observable</h4> <p>The <code class="highlighter-rouge">translateX</code> observable is the central observable of this component. It emits the current x-coordinate of the drawer, which can be modified by either of 3 incoming observables:</p> <ol> <li>The move observable (the user’s finger/mouse moving across the screen),</li> <li>the animation/tween observable, and</li> <li>direct modifications of the <code class="highlighter-rouge">opened</code> state.</li> </ol> <p>It is wrapped in a <code class="highlighter-rouge">defer</code> because it depends on previous values of itself.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">ref</span><span class="p">.</span><span class="nx">translateX$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">defer</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">merge</span><span class="p">(</span>
</code></pre></div></div> <p>1) We only let move events modify the drawer’s position when we are sure that the user is sliding. In case the <code class="highlighter-rouge">preventDefault</code> option is enabled, this is also when we’re sure to call <code class="highlighter-rouge">preventDefault</code>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="nx">move$</span><span class="p">::</span><span class="nx">filterWhen</span><span class="p">(</span><span class="nx">isSliding$</span><span class="p">)</span>
        <span class="p">::</span><span class="nx">effect</span><span class="p">(({</span> <span class="nx">event</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">)</span> <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="p">})</span>
</code></pre></div></div> <p>Finally, we take the start position of the finger, the start position of the drawer, and the current position of the finger to calculate the next <code class="highlighter-rouge">translateX</code> value.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">::</span><span class="nx">withLatestFrom</span><span class="p">(</span><span class="nx">start$</span><span class="p">,</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">startTranslateX$</span><span class="p">)</span>
        <span class="p">::</span><span class="nx">map</span><span class="p">(([{</span> <span class="nx">clientX</span> <span class="p">},</span> <span class="p">{</span> <span class="na">clientX</span><span class="p">:</span> <span class="nx">startX</span> <span class="p">},</span> <span class="nx">startTranslateX</span><span class="p">])</span> <span class="o">=&gt;</span>
          <span class="k">this</span><span class="p">::</span><span class="nx">calcTranslateX</span><span class="p">(</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">startX</span><span class="p">,</span> <span class="nx">startTranslateX</span><span class="p">)),</span>
</code></pre></div></div> <p>2) The tween observable can be used unmodified (see below), but isn’t defined yet, because it depends on previous values of <code class="highlighter-rouge">translateX$</code>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="nx">ref</span><span class="p">.</span><span class="nx">tween$</span><span class="p">,</span>
</code></pre></div></div> <p>3) When the <code class="highlighter-rouge">opened</code> state changes, we “jump” to the new position, which is either 0 (when closed) or the width of the drawer (when open). We also want to jump when <code class="highlighter-rouge">align</code> chagnes, in this case to the other side of the viewport.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="nx">Observable</span><span class="p">::</span><span class="nx">combineLatest</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">sOpened$</span><span class="p">],</span> <span class="k">this</span><span class="p">[</span><span class="nx">sAlign$</span><span class="p">])</span>
</code></pre></div></div> <p>Usually the cleanup code would run at the end of the fling animation, but since there is no animation in this case, we call it directly.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="p">::</span><span class="nx">effect</span><span class="p">(([</span><span class="nx">opened</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">::</span><span class="nx">cleanupInteraction</span><span class="p">(</span><span class="nx">opened</span><span class="p">))</span>
        <span class="cm">/* TODO: drawerWdith could be outdated */</span>
        <span class="p">::</span><span class="nx">map</span><span class="p">(([</span><span class="nx">opened</span><span class="p">,</span> <span class="nx">align</span><span class="p">])</span> <span class="o">=&gt;</span>
          <span class="p">(</span><span class="o">!</span><span class="nx">opened</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">this</span><span class="p">[</span><span class="nx">sDrawerWidth</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nx">align</span> <span class="o">===</span> <span class="s1">'left'</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">))),</span>
  <span class="p">))</span>
</code></pre></div></div> <p><code class="highlighter-rouge">share</code>ing the observable between many subscribers:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">::</span><span class="nx">share</span><span class="p">();</span>
</code></pre></div></div> <p>The <code class="highlighter-rouge">translateX</code> value at the start of an interaction. Typically this would be either 0 or <code class="highlighter-rouge">drawerWidth</code>, but since the user can initiate an interaction <em>during the animation</em>, it may be every value inbetween. We obtain it by sampling the translate X observable at the beginning of each interaction.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">ref</span><span class="p">.</span><span class="nx">startTranslateX$</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">translateX$</span><span class="p">::</span><span class="nx">sample</span><span class="p">(</span><span class="nx">start$</span><span class="p">);</span>
</code></pre></div></div> <h4 id="tween-observable">Tween observable</h4> <p>For the tween animations we first need an observable that tracks the current velocity of the drawer, which we will use to determine whether the drawer should flinging in its direction, or snap back into place.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">const</span> <span class="nx">velocity$</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">translateX$</span>
    <span class="p">::</span><span class="nx">timestamp</span><span class="p">()</span>
    <span class="p">::</span><span class="nx">pairwise</span><span class="p">()</span>
</code></pre></div></div> <p>Since we are at the mercy of the browser firing move events, we make sure that some time has passed since the last move event.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">::</span><span class="nx">filter</span><span class="p">(([{</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nx">prevTime</span> <span class="p">},</span> <span class="p">{</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nx">time</span> <span class="p">}])</span> <span class="o">=&gt;</span> <span class="nx">time</span> <span class="o">-</span> <span class="nx">prevTime</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div> <p>Now we are save to calculate the current velocity without divide by zero errors.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">::</span><span class="nx">map</span><span class="p">(([</span>
      <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">prevX</span><span class="p">,</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nx">prevTime</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">x</span><span class="p">,</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nx">time</span> <span class="p">},</span>
    <span class="p">])</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">prevX</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">time</span> <span class="o">-</span> <span class="nx">prevTime</span><span class="p">))</span>
</code></pre></div></div> <p>The initial velocity is zero.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">::</span><span class="nx">startWith</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></div> <p>There are 2 things that can trigger an animation:</p> <ol> <li>The end of an interaction, i.e. the user releases the finger/mouse while moving the slider.</li> <li>A call to a method like <code class="highlighter-rouge">open</code> or <code class="highlighter-rouge">close</code> (represented by a value on the animate observable)</li> </ol> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">const</span> <span class="nx">tweenTrigger$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">::</span><span class="nx">merge</span><span class="p">(</span>
</code></pre></div></div> <p>1) When the user releases the finger/mouse, we take the current velocity of the drawer and calculate whether it should open or close.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="nx">end$</span>
        <span class="p">::</span><span class="nx">withLatestFrom</span><span class="p">(</span><span class="nx">ref</span><span class="p">.</span><span class="nx">translateX$</span><span class="p">,</span> <span class="nx">velocity$</span><span class="p">)</span>
        <span class="p">::</span><span class="nx">map</span><span class="p">(([,</span> <span class="nx">translateX</span><span class="p">,</span> <span class="nx">velocity</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">::</span><span class="nx">calcWillOpen</span><span class="p">(</span><span class="nx">velocity</span><span class="p">,</span> <span class="nx">translateX</span><span class="p">))</span>
        <span class="p">::</span><span class="nx">effect</span><span class="p">(</span><span class="nx">willOpen</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">[</span><span class="nx">sFire</span><span class="p">](</span><span class="s1">'slideend'</span><span class="p">,</span> <span class="p">{</span> <span class="na">detail</span><span class="p">:</span> <span class="nx">willOpen</span> <span class="p">})),</span>
</code></pre></div></div> <p>2) In this case we need to call the prepare code directly, which would have been called at the beginning of the interaction otherwise.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">this</span><span class="p">[</span><span class="nx">sAnimateTo$</span><span class="p">]::</span><span class="nx">effect</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="nx">prepareInteraction</span><span class="p">),</span>
  <span class="p">);</span>
</code></pre></div></div> <p>We silently set the new <code class="highlighter-rouge">opened</code> state here, so that the next interaction will do the right thing even while the animation is still playing, e.g. a call to <code class="highlighter-rouge">toggle</code> will cancel the current animation and initiate an animation to the opposite state.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">ref</span><span class="p">.</span><span class="nx">tween$</span> <span class="o">=</span> <span class="nx">tweenTrigger$</span>
    <span class="p">::</span><span class="nx">effect</span><span class="p">((</span><span class="nx">willOpen</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">sSetState</span><span class="p">](</span><span class="s1">'opened'</span><span class="p">,</span> <span class="nx">willOpen</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">sScrollEl</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">willOpen</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">sScrollEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">overflow</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="p">})</span>
</code></pre></div></div> <p>By using <code class="highlighter-rouge">switchMap</code> we ensure that subsequent events that trigger an animation don’t cause more than one animation to be played at a time.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">::</span><span class="nx">withLatestFrom</span><span class="p">(</span><span class="nx">ref</span><span class="p">.</span><span class="nx">translateX$</span><span class="p">)</span>
    <span class="p">::</span><span class="nx">switchMap</span><span class="p">(([</span><span class="nx">opened</span><span class="p">,</span> <span class="nx">translateX</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="p">{</span>
</code></pre></div></div> <p>We return a tween observable that runs cleanup code when it completes — unless a new interaction is initiated, in which case it is canceled.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="kd">const</span> <span class="nx">inv</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">align</span> <span class="o">===</span> <span class="s1">'left'</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">endTranslateX</span> <span class="o">=</span> <span class="nx">opened</span> <span class="p">?</span> <span class="k">this</span><span class="p">[</span><span class="nx">sDrawerWidth</span><span class="p">]</span> <span class="o">*</span> <span class="nx">inv</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">diffTranslateX</span> <span class="o">=</span> <span class="nx">endTranslateX</span> <span class="o">-</span> <span class="nx">translateX</span><span class="p">;</span>

      <span class="k">return</span> <span class="nx">createTween</span><span class="p">(</span><span class="nx">linearTween</span><span class="p">,</span> <span class="nx">translateX</span><span class="p">,</span> <span class="nx">diffTranslateX</span><span class="p">,</span> <span class="nx">TRANSITION_DURATION</span><span class="p">)</span>
        <span class="p">::</span><span class="nx">effect</span><span class="p">({</span> <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">[</span><span class="nx">sOpened$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="nx">opened</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">::</span><span class="nx">takeUntil</span><span class="p">(</span><span class="nx">start$</span><span class="p">)</span>
        <span class="p">::</span><span class="nx">takeUntil</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">sAlign$</span><span class="p">]);</span>
    <span class="p">});</span>
</code></pre></div></div> <h4 id="subscriptions">Subscriptions</h4> <p>Now we are ready to cause some side effects.</p> <p>The end result is always to update the (shadow) DOM, which happens here. Note that the call to subscribe sets the whole process in motion, and causes the code inside the above <code class="highlighter-rouge">defer</code> observables to run.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">ref</span><span class="p">.</span><span class="nx">translateX$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">updateDOM</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
</code></pre></div></div> <p>A click on the scrim should close the drawer.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">Observable</span><span class="p">::</span><span class="nx">fromEvent</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">sScrimEl</span><span class="p">],</span> <span class="s1">'click'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">());</span>
</code></pre></div></div> <p>Other than preventing sliding, setting <code class="highlighter-rouge">persistent</code> will also hide the scrim.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">active$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">active</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">sScrimEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="nx">active</span> <span class="p">?</span> <span class="s1">'block'</span> <span class="p">:</span> <span class="s1">'none'</span><span class="p">;</span>
  <span class="p">});</span>
</code></pre></div></div> <p>Whenever the alignment of the drawer changes, update the CSS classes.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">this</span><span class="p">[</span><span class="nx">sAlign$</span><span class="p">]</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">align</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">oldAlign</span> <span class="o">=</span> <span class="nx">align</span> <span class="o">===</span> <span class="s1">'left'</span> <span class="p">?</span> <span class="s1">'right'</span> <span class="p">:</span> <span class="s1">'left'</span><span class="p">;</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">`hy-drawer-</span><span class="p">${</span><span class="nx">oldAlign</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">`hy-drawer-</span><span class="p">${</span><span class="nx">align</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div></div> <p>If the experimental back button feature is enabled, handle popstate events…</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">Observable</span><span class="p">::</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">'popstate'</span><span class="p">)</span>
    <span class="p">::</span><span class="nx">subscribeWhen</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">sBackButton$</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="s2">`#</span><span class="p">${</span><span class="k">this</span><span class="p">::</span><span class="nx">histId</span><span class="p">()}</span><span class="s2">--opened`</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">willOpen</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">===</span> <span class="nx">hash</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">willOpen</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">opened</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">sAnimateTo$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="nx">willOpen</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div></div> <p>Now we set the initial opend state. If the experimental back button feature is enabled, we check the location hash…</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_backButton</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="s2">`#</span><span class="p">${</span><span class="k">this</span><span class="p">::</span><span class="nx">histId</span><span class="p">()}</span><span class="s2">--opened`</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">===</span> <span class="nx">hash</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">sSetState</span><span class="p">](</span><span class="s1">'opened'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div> <p>Putting initial values on the side-effect–observables:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">this</span><span class="p">[</span><span class="nx">sOpened$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">opened</span><span class="p">);</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sAlign$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">align</span><span class="p">);</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sPersitent$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">persistent</span><span class="p">);</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sPreventDefault$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">);</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sMouseEvents$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mouseEvents</span><span class="p">);</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">sBackButton$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_backButton</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="drawer-mixin">Drawer Mixin</h2> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">drawerMixin</span><span class="p">(</span><span class="nx">C</span><span class="p">)</span> <span class="p">{</span>
</code></pre></div></div> <p>TODO: see ES6 mixins…</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">return</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">componentMixin</span><span class="p">(</span><span class="nx">C</span><span class="p">)</span> <span class="p">{</span>
</code></pre></div></div> <p>The name of the component (required by hy-component)</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kr">static</span> <span class="kd">get</span> <span class="nx">componentName</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">'hy-drawer'</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div> <h3 id="setup">Setup</h3> <p>Overriding the setup function.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">[</span><span class="nx">sSetup</span><span class="p">](</span><span class="nx">el</span><span class="p">,</span> <span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">super</span><span class="p">[</span><span class="nx">sSetup</span><span class="p">](</span><span class="nx">el</span><span class="p">,</span> <span class="nx">props</span><span class="p">);</span>
</code></pre></div></div> <p>Cache DOM elements.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">this</span><span class="p">[</span><span class="nx">sScrimEl</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.hy-drawer-scrim'</span><span class="p">);</span>
      <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.hy-drawer-content'</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_hideOverflow</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">sScrollEl</span><span class="p">]</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_hideOverflow</span><span class="p">);</span>
</code></pre></div></div> <p>Set the initial alignment class.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">`hy-drawer-</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">align</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
</code></pre></div></div> <p>Measure the current drawer width…</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">this</span><span class="p">[</span><span class="nx">sDrawerWidth</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">::</span><span class="nx">getMovableDrawerWidth</span><span class="p">();</span>
</code></pre></div></div> <p>…and keep it up-to-date. Note that we need to temporarily remove the opened class to get the correct measures.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="nx">Observable</span><span class="p">::</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">'resize'</span><span class="p">,</span> <span class="p">{</span> <span class="na">passive</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
        <span class="p">::</span><span class="nx">debounceTime</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">opened</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'hy-drawer-opened'</span><span class="p">);</span>
          <span class="k">this</span><span class="p">[</span><span class="nx">sDrawerWidth</span><span class="p">]</span> <span class="o">=</span> <span class="na">this</span><span class="p">::</span><span class="nx">getMovableDrawerWidth</span><span class="p">();</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">opened</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">sContentEl</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'hy-drawer-opened'</span><span class="p">);</span>
        <span class="p">});</span>
</code></pre></div></div> <p>Finally, calling the <a href="#setup-observables">setup observables function</a> function.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">this</span><span class="p">::</span><span class="nx">setupObservables</span><span class="p">();</span>
</code></pre></div></div> <p>Firing an event to let the outside world know the drawer is ready.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">this</span><span class="p">[</span><span class="nx">sFire</span><span class="p">](</span><span class="s1">'init'</span><span class="p">,</span> <span class="p">{</span> <span class="na">detail</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">opened</span> <span class="p">});</span>
</code></pre></div></div> <p>Allow function chaining.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div> <h3 id="options">Options</h3> <p>The default values (and types) of the configuration options (required by hy-component) See <a href="/hy-drawer/doc/options/">Options</a> for usage information.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kr">static</span> <span class="kd">get</span> <span class="nx">defaults</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">opened</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">align</span><span class="p">:</span> <span class="s1">'left'</span><span class="p">,</span>
        <span class="na">persistent</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">range</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="na">threshold</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="na">preventDefault</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">mouseEvents</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">_backButton</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">_hideOverflow</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="kr">static</span> <span class="kd">get</span> <span class="nx">types</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">opened</span><span class="p">:</span> <span class="nx">bool</span><span class="p">,</span>
        <span class="na">align</span><span class="p">:</span> <span class="nx">oneOf</span><span class="p">([</span><span class="s1">'left'</span><span class="p">,</span> <span class="s1">'right'</span><span class="p">]),</span>
        <span class="na">persistent</span><span class="p">:</span> <span class="nx">bool</span><span class="p">,</span>
        <span class="na">range</span><span class="p">:</span> <span class="nx">arrayOf</span><span class="p">(</span><span class="nx">number</span><span class="p">),</span>
        <span class="na">threshold</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
        <span class="na">preventDefault</span><span class="p">:</span> <span class="nx">bool</span><span class="p">,</span>
        <span class="na">mouseEvents</span><span class="p">:</span> <span class="nx">bool</span><span class="p">,</span>
        <span class="na">_backButton</span><span class="p">:</span> <span class="nx">bool</span><span class="p">,</span>
        <span class="na">_hideOverflow</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
      <span class="p">};</span>
    <span class="p">}</span>
</code></pre></div></div> <p>Side effects of changing configuration options (if any). Mostly we just put the value on an observable and deal with it from there.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kr">static</span> <span class="kd">get</span> <span class="nx">sideEffects</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">opened</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">[</span><span class="nx">sOpened$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">},</span>
        <span class="nx">align</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">[</span><span class="nx">sAlign$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">},</span>
        <span class="nx">persistent</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">[</span><span class="nx">sPersitent$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">},</span>
        <span class="nx">preventDefault</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">[</span><span class="nx">sPreventDefault$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">},</span>
        <span class="nx">mouseEvents</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">[</span><span class="nx">sMouseEvents$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">},</span>
        <span class="nx">_backButton</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">[</span><span class="nx">sBackButton$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">},</span>
        <span class="nx">_hideOverflow</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">sScrollEl</span><span class="p">])</span> <span class="k">this</span><span class="p">[</span><span class="nx">sScrollEl</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">overflow</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
          <span class="k">this</span><span class="p">[</span><span class="nx">sScrollEl</span><span class="p">]</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
        <span class="p">},</span>
      <span class="p">};</span>
    <span class="p">}</span>
</code></pre></div></div> <h3 id="methods">Methods</h3> <p>Public methods of this component. See <a href="/hy-drawer/doc/methods/">Methods</a> for more.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">open</span><span class="p">(</span><span class="nx">animated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">animated</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">sAnimateTo$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">opened</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">close</span><span class="p">(</span><span class="nx">animated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">animated</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">sAnimateTo$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">opened</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">toggle</span><span class="p">(</span><span class="nx">animated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">animated</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">sAnimateTo$</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">opened</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">opened</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">opened</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <p>This concludes the implementation of push-state mixin. You can now check out</p> <ul> <li><a href="/hy-drawer/doc/source/vanilla/">vanilla / index.js</a></li> <li><a href="/hy-drawer/doc/source/jquery/">jquery / index.js</a></li> <li><a href="/hy-drawer/doc/source/webcomponent/">webcomponent / index.js</a></li> </ul> <p>to see how it is used.</p> </article> <footer role="contentinfo"> <hr/> <p><small class="copyright">© 2017 Florian Klampfer</small></p> <p><small>Powered by <a class="external" href="https://qwtel.com/hydejack/">Hydejack</a> v<span id="_version">7.0.0-beta.7</span></small></p> <hr class="sr-only"/> </footer> </main> <hy-drawer> <header id="_sidebar" class="sidebar" role="banner"> <div class="sidebar-bg sidebar-overlay" style="background:linear-gradient(to bottom,#193747 0%,#233e4c 30%,#3c929e 50%,#d5d5d4 70%,#cdccc8 100%)"></div> <div class="sidebar-sticky"> <div class="sidebar-about"> <h2 class="h1"><a href="/hy-drawer/">hy-drawer</a></h2> <p class=""> A touch-enabled drawer component for the modern web. </p> </div> <nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span> <ul> <li> <a id="_navigation" href="/hy-drawer/doc/options/" class="sidebar-nav-item" > Options </a> </li> <li> <a href="/hy-drawer/doc/methods/" class="sidebar-nav-item" > Methods </a> </li> <li> <a href="/hy-drawer/doc/events/" class="sidebar-nav-item" > Events </a> </li> <li> <a href="/hy-drawer/doc/styling/" class="sidebar-nav-item" > Styling </a> </li> </ul> </nav> <div class="sidebar-social"> <span class="sr-only">Social</span> <ul> <li> <a href="https://github.com/qwtel/hy-drawer" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a> </li> <li> <a href="https://www.npmjs.com/package/hy-drawer" title="npm" class="no-mark-external"> <span class="icon-npm"></span> <span class="sr-only">npm</span> </a> </li> <li> <a href="https://github.com/qwtel/hy-drawer/archive/v1.0.0-hydejack.5.zip" title="Download" class="no-mark-external"> <span class="icon-box-add"></span> <span class="sr-only">Download</span> </a> </li> </ul> </div> </div> </header> </hy-drawer> </hy-push-state> <!--[if gt IE 9]><!----> <script>loadJSDeferred('/hy-drawer/assets/js/hydejack.js?v=7.0.0-beta.7');</script> <!-- <script> function detectCFScript() { var cfScript = Array.prototype.find.call(document.scripts, function(s) { return s !== document.currentScript && s.textContent.indexOf('__cf_email__') > -1; }); if (cfScript) this.addEventListener('hy-push-state-load', new Function(cfScript.textContent)); this.removeEventListener('hy-push-state-init', detectCFScript); } document .getElementsByTagName('hy-push-state')[0] .addEventListener('hy-push-state-init', detectCFScript); </script> --> <!--<![endif]--> <hr class="sr-only"/> <h2 class="sr-only">Templates:</h2> <template id="_animation-template"> <div class="animation-main fixed-top"> <div class="content"> <div class="page"></div> </div> </div> </template> <template id="_loading-template"> <div class="loading"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span> </div> </template> <template id="_error-template"> <div class="page"> <h1 class="page-title">Error</h1> <p class="lead"> Sorry, an error occurred while loading: <a class="this-link" href=""></a>. </p> </div> </template> <template id="_back-template"> <a id="_back" class="back nav-btn no-hover"> <span class="sr-only">Back</span> <span class="icon-arrow-left2"></span> </a> </template> </body></html>
